{{ define "main" }}
<div class="journey-viewport overflow-hidden relative bg-slate-50 dark:bg-[#020617]">
    
    <!-- Navigation Help UI (Desktop Only) -->
    <div class="hidden lg:flex fixed bottom-8 left-1/2 -translate-x-1/2 z-50 bg-slate-950/80 backdrop-blur-md text-white px-6 py-3 rounded-full items-center gap-4 border border-white/10 shadow-2xl">
        <div class="flex items-center gap-2">
            <kbd class="bg-white/10 px-2 py-0.5 rounded text-[10px]">DRAG</kbd>
            <span class="text-xs font-bold uppercase tracking-widest text-white/60">to explore landscape</span>
        </div>
        <div class="w-[1px] h-4 bg-white/20"></div>
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-twitter rounded-full animate-pulse"></span>
            <span class="text-xs font-bold uppercase tracking-widest text-white/60">Hover Nodes</span>
        </div>
    </div>

    <!-- The Journey Track -->
    <div id="journey-track" class="journey-track relative transition-transform duration-100 ease-out cursor-grab active:cursor-grabbing">
        
        <!-- Desktop Straight Path (Horizontal) -->
        <div class="hidden lg:block absolute top-1/2 left-0 right-0 h-1 bg-twitter/20 -translate-y-1/2 z-0">
            <div class="w-full h-full shadow-[0_0_20px_rgba(29,155,240,0.3)]"></div>
        </div>

        <!-- Mobile Vertical Path -->
        <div class="lg:hidden absolute left-8 top-0 bottom-0 w-1 bg-twitter/20 z-0"></div>

        <div class="milestones-container flex flex-col lg:flex-row items-start lg:items-center">
            {{ $paginator := .Paginate (where .Site.RegularPages "Section" "ne" "works") }}
            {{ range $index, $page := $paginator.Pages }}
                {{ $isEven := eq (mod $index 2) 0 }}
                
                <div class="milestone-node relative z-10 flex flex-row lg:flex-col items-center">
                    
                    <!-- Content Card -->
                    <div class="milestone-content order-2 lg:order-none lg:absolute {{ if $isEven }}lg:bottom-full lg:mb-12{{ else }}lg:top-full lg:mt-12{{ end }} transition-all duration-500">
                        <a href="{{ .RelPermalink }}" class="block p-6 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl rounded-[2.5rem] border-2 border-slate-100 dark:border-slate-800 shadow-xl hover:border-twitter transition-all group">
                            {{ $img := "" }}
                            {{ if .Params.image }}
                                {{ $res := .Resources.GetMatch .Params.image }}{{ if $res }}{{ $img = ($res.Process "webp q75").RelPermalink }}{{ end }}
                            {{ end }}

                            {{ if $img }}
                            <div class="w-full h-40 lg:h-32 mb-4 overflow-hidden rounded-2xl bg-slate-100">
                                <img src="{{ $img }}" alt="{{ .Title }}" class="w-full h-full object-cover">
                            </div>
                            {{ end }}
                            
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-[8px] font-black text-twitter uppercase tracking-[0.2em] bg-twitter/5 px-2 py-0.5 rounded-full border border-twitter/10">
                                    {{ .Date.Format "2006" }}
                                </span>
                            </div>
                            <h2 class="text-sm lg:text-xs font-black text-slate-950 dark:text-white uppercase tracking-tight leading-tight line-clamp-2">{{ .Title }}</h2>
                        </a>
                    </div>

                    <!-- The Hotspot (Anchor) -->
                    <div class="hotspot-wrapper relative z-20 flex items-center justify-center w-16 lg:w-[400px] h-16 shrink-0 order-1 lg:order-none">
                        <div class="absolute inset-0 bg-twitter/10 rounded-full animate-ping opacity-20"></div>
                        <div class="relative w-5 h-5 rounded-full border-4 border-white dark:border-slate-900 bg-twitter shadow-lg shadow-twitter/40"></div>
                        
                        <!-- Desktop Connector Line -->
                        <div class="hidden lg:block absolute {{ if $isEven }}bottom-full h-12{{ else }}top-full h-12{{ end }} w-0.5 bg-twitter/20"></div>
                    </div>
                </div>
            {{ end }}
        </div>
    </div>
</div>

<script>
    const container = document.querySelector('.journey-viewport');
    const track = document.getElementById('journey-track');
    
    // Only run horizontal drag on desktop
    if (window.innerWidth > 1024) {
        let isDown = false;
        let startX;
        let scrollLeft;

        container.addEventListener('mousedown', (e) => {
            isDown = true;
            container.style.cursor = 'grabbing';
            startX = e.pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
        });
        container.addEventListener('mouseleave', () => {
            isDown = false;
            container.style.cursor = 'grab';
        });
        container.addEventListener('mouseup', () => {
            isDown = false;
            container.style.cursor = 'grab';
        });
        container.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - container.offsetLeft;
            const walk = (x - startX) * 2;
            container.scrollLeft = scrollLeft - walk;
        });
    }
</script>
{{ end }}